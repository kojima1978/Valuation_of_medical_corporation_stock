<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>出資持分評価額 試算結果</title>
  <style>
    body {
      font-family: "Yu Gothic", "Hiragino Kaku Gothic ProN", Meiryo, sans-serif;
      line-height: 1.6;
      margin: 24px;
    }
    h1, h2, h3 {
      margin-top: 32px;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 12px;
    }
    th, td {
      border: 1px solid #999;
      padding: 8px;
      text-align: right;
      white-space: nowrap;
    }
    th {
      background-color: #f2f2f2;
      text-align: center;
    }
    td.left {
      text-align: left;
    }
    .note {
      font-size: 0.9em;
      color: #555;
      margin-top: 8px;
    }
    .highlight {
      font-weight: bold;
    }
    .button-container {
      margin-top: 32px;
      text-align: center;
    }
    .back-button {
      background-color: #4CAF50;
      color: white;
      padding: 12px 24px;
      font-size: 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      text-decoration: none;
      display: inline-block;
    }
    .back-button:hover {
      background-color: #45a049;
    }
  </style>
</head>
<body>

<script>
  // ページ読み込み時に出資者情報を表示
  window.addEventListener('DOMContentLoaded', function() {
    // localStorageから出資者データを取得
    const investorDataJson = localStorage.getItem('investorData');

    if (investorDataJson) {
      const investors = JSON.parse(investorDataJson);

      // 1口あたりの評価額を取得（参考情報から）
      const perShareValue = 823; // 1口あたりの評価額(円)

      const tbody = document.getElementById('investorResultTableBody');
      let totalInvestment = 0;
      let totalEvaluation = 0;

      // 各出資者の行を作成
      investors.forEach((investor, index) => {
        const amount = investor.amount || 0;

        // 出資持分評価額の計算: (出資金額 ÷ 50円) × 1口あたりの評価額
        const shares = amount / 50; // 口数
        const evaluationValue = shares * perShareValue; // 評価額(円)
        const evaluationValueThousand = Math.round(evaluationValue / 1000); // 千円単位

        totalInvestment += amount;
        totalEvaluation += evaluationValueThousand;

        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${index + 1}</td>
          <td class="left">${investor.name || ''}</td>
          <td>${amount.toLocaleString('ja-JP')}円</td>
          <td>${evaluationValueThousand.toLocaleString('ja-JP')}千円</td>
        `;
        tbody.appendChild(row);
      });

      // 合計を更新
      document.getElementById('totalInvestmentAmount').textContent = totalInvestment.toLocaleString('ja-JP') + '円';
      document.getElementById('totalEvaluationAmount').textContent = totalEvaluation.toLocaleString('ja-JP') + '千円';

      // 出資金額総額を更新（千円単位）
      const totalCapitalThousand = Math.round(totalInvestment / 1000);
      document.getElementById('totalCapital').textContent = totalCapitalThousand.toLocaleString('ja-JP') + '千円';

      // 総出資口数を計算（出資金額総額 ÷ 50円）
      const totalSharesCount = totalInvestment / 50;
      document.getElementById('totalShares').textContent = totalSharesCount.toLocaleString('ja-JP') + '口';
    }

    // 相続税評価額による純資産を取得して表示
    const netAssetTaxValue = localStorage.getItem('netAssetTaxValue');
    if (netAssetTaxValue) {
      const netAssetTaxValueNum = parseFloat(netAssetTaxValue) || 0;
      const netAssetTaxValueThousand = Math.round(netAssetTaxValueNum / 1000);
      document.getElementById('inheritanceTaxValue').textContent = netAssetTaxValueThousand.toLocaleString('ja-JP') + '千円';

      // 1口あたりの純資産価額方式による評価額を計算
      // = 出資持分の相続税評価額(円) ÷ 総出資口数
      const investorDataJson = localStorage.getItem('investorData');
      if (investorDataJson) {
        const investors = JSON.parse(investorDataJson);
        let totalInvestment = 0;
        investors.forEach(investor => {
          totalInvestment += investor.amount || 0;
        });
        const totalSharesCount = totalInvestment / 50;

        if (totalSharesCount > 0) {
          const perShareNetAsset = Math.round(netAssetTaxValueNum / totalSharesCount);
          document.getElementById('perShareNetAssetValue').textContent = perShareNetAsset.toLocaleString('ja-JP') + '円';
        }
      }
    }

    // 会社規模を判定（小売・サービス業基準）
    const employees = localStorage.getItem('employees');
    const totalAssets = localStorage.getItem('totalAssets');
    const sales = localStorage.getItem('sales');

    if (employees && totalAssets && sales) {
      const companySize = determineCompanySize(employees, totalAssets, sales);
      document.getElementById('companySize').textContent = companySize;
    }
  });

  // 会社規模判定関数（小売・サービス業基準）
  function determineCompanySize(employees, totalAssets, sales) {
    const empNum = parseInt(employees);
    const assetsNum = parseInt(totalAssets);
    const salesNum = parseInt(sales);

    // 大会社判定
    if (empNum === 5) { // 70人以上
      return '大会社';
    }
    if (assetsNum === 5 && empNum > 3) { // 15億円以上（従業員数が35人以下の会社を除く）
      return '大会社';
    }
    if (salesNum === 5) { // 20億円以上
      return '大会社';
    }

    // 小会社判定
    if (assetsNum === 1) { // 4,000万円未満
      return '小会社';
    }
    if (empNum === 1) { // 従業員数が5人以下
      return '小会社';
    }
    if (salesNum === 1) { // 6,000万円未満
      return '小会社';
    }

    // 中会社判定（上記以外）
    // 中会社の大・中・小を判定
    // L=0.90: 総資産5億円以上（従業員35人以下除く）または売上5億円以上20億円未満
    if ((assetsNum === 4 && empNum > 3) || (assetsNum === 3 && empNum > 3) || salesNum === 4) {
      return '中会社の大';
    }
    // L=0.75: 総資産2.5億円以上（従業員20人以下除く）または売上2.5億円以上5億円未満
    if ((assetsNum === 3 && empNum > 2) || salesNum === 3) {
      return '中会社の中';
    }
    // L=0.60: 総資産4,000万円以上（従業員5人以下除く）または売上6,000万円以上2.5億円未満
    if ((assetsNum >= 2 && empNum > 1) || salesNum === 2) {
      return '中会社の小';
    }

    return '中会社';
  }
</script>

<h1>評価額の概算（計算結果）</h1>

<h2>1．出資持分評価額・持分なし医療法人移行時のみなし贈与税額</h2>

<table>
  <thead>
    <tr>
      <th class="left">項目</th>
      <th>金額</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td class="left">当初出資額（設立時）</td>
      <td>5,000千円</td>
    </tr>
    <tr>
      <td class="left">出資持分評価額（現在：持分あり医療法人）</td>
      <td class="highlight">82,300千円</td>
    </tr>
    <tr>
      <td class="left">持分なし医療法人移行時のみなし贈与税額</td>
      <td>40,660千円</td>
    </tr>
  </tbody>
</table>

<p class="note">
※ 全出資者がすべての持分を放棄した場合の、医療法人へのみなし贈与税額の試算です。
</p>

<h2>2．各出資者の出資持分評価額</h2>

<table>
  <thead>
    <tr>
      <th>№</th>
      <th class="left">出資者名</th>
      <th>出資金額</th>
      <th>出資持分評価額</th>
    </tr>
  </thead>
  <tbody id="investorResultTableBody">
    <!-- ここに動的に出資者データが挿入されます -->
  </tbody>
  <tfoot>
    <tr style="background-color: #f2f2f2; font-weight: bold;">
      <th>合計</th>
      <th></th>
      <th id="totalInvestmentAmount">0円</th>
      <th id="totalEvaluationAmount">0千円</th>
    </tr>
  </tfoot>
</table>

<h2>（参考）出資持分評価額を算定する上での各要素</h2>

<table>
  <thead>
    <tr>
      <th class="left">項目</th>
      <th>対象法人</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td class="left">会社規模</td>
      <td id="companySize">未入力</td>
    </tr>
    <tr>
      <td class="left">特定の評価会社の該当判定</td>
      <td>非該当</td>
    </tr>
    <tr>
      <td class="left">出資金額総額</td>
      <td id="totalCapital">未入力</td>
    </tr>
    <tr>
      <td class="left">総出資口数（1口50円と仮定）</td>
      <td id="totalShares">未入力</td>
    </tr>
    <tr>
      <td class="left">出資持分の相続税評価額</td>
      <td id="inheritanceTaxValue">82,300千円</td>
    </tr>
    <tr>
      <td class="left">持分なし医療法人移行時のみなし贈与税額</td>
      <td>40,660千円</td>
    </tr>
    <tr>
      <td class="left">1口あたりの類似業種比準価額方式による評価額</td>
      <td>921円</td>
    </tr>
    <tr>
      <td class="left">　類似業種の利益</td>
      <td>51円</td>
    </tr>
    <tr>
      <td class="left">　類似業種の純資産</td>
      <td>395円</td>
    </tr>
    <tr>
      <td class="left">　類似業種の令和6年平均株価</td>
      <td>532円</td>
    </tr>
    <tr>
      <td class="left">1口あたりの純資産価額方式による評価額</td>
      <td id="perShareNetAssetValue">676円</td>
    </tr>
    <tr>
      <td class="left">1口あたりの評価額</td>
      <td>823円</td>
    </tr>
  </tbody>
</table>

<p class="note">
※ 類似業種の株価等は、令和7年12月時点の公表データを採用しています。
</p>

<div class="button-container">
  <button class="back-button" onclick="goBack()">← 入力画面に戻る</button>
</div>

<script>
  function goBack() {
    // ブラウザの履歴を使って前のページに戻る（データは保持される）
    window.history.back();
  }
</script>

</body>
</html>
