<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>出資持分の評価額試算ツール</title>
  <style>
    body {
      font-family: "Yu Gothic", "Hiragino Kaku Gothic ProN", Meiryo, sans-serif;
      line-height: 1.6;
      margin: 24px;
    }
    h1, h2, h3 {
      margin-top: 32px;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 12px;
    }
    th, td {
      border: 1px solid #999;
      padding: 8px;
      text-align: right;
    }
    th {
      background-color: #f2f2f2;
      text-align: center;
    }
    td.left {
      text-align: left;
    }
    input[type="text"],
    input[type="number"],
    select {
      width: 100%;
      box-sizing: border-box;
      padding: 4px;
    }
    button.add-row {
      background-color: #16a34a;
      color: white;
      border: none;
      padding: 8px 16px;
      margin-top: 12px;
      margin-bottom: 20px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }
    button.add-row:hover {
      background-color: #2563eb;
    }
    button.info-btn {
      background-color: #2563eb;
      color: white;
      border: none;
      padding: 4px 8px;
      margin-left: 8px;
      border-radius: 3px;
      cursor: pointer;
      font-size: 12px;
      vertical-align: middle;
    }
    button.info-btn:hover {
      background-color: #16a34a;
    }
    .info-popup {
      display: none;
      position: absolute;
      background-color: #f9f9f9;
      border: 1px solid #999;
      padding: 12px;
      border-radius: 4px;
      margin-top: 8px;
      font-size: 0.85em;
      color: #333;
      max-width: 400px;
      z-index: 1000;
    }
    .info-popup.show {
      display: block;
    }
    .note {
      font-size: 0.9em;
      color: #555;
      margin-top: 12px;
      margin-bottom: 20px;
    }
    .section {
      margin-top: 40px;
      margin-bottom: 20px;
    }
    button.copy-btn {
      background-color: #16a34a;
      color: white;
      border: none;
      padding: 6px 12px;
      margin-left: 8px;
      border-radius: 3px;
      cursor: pointer;
      font-size: 13px;
    }
    button.copy-btn:hover {
      background-color: #15803d;
    }
  </style>
</head>
<body>

<script>
  function addInvestorRow() {
    const tbody = document.getElementById('investorTableBody');
    const rowCount = tbody.querySelectorAll('.investor-row').length + 1;
    
    const newRow = document.createElement('tr');
    newRow.className = 'investor-row';
    newRow.innerHTML = `
      <td class="row-number">${rowCount}</td>
      <td class="left"><input type="text"></td>
      <td><input type="number" class="investor-amount" oninput="updateInvestorTotal()"></td>
    `;
    
    tbody.appendChild(newRow);
    updateInvestorTotal();
  }

  function updateInvestorTotal() {
    const amounts = document.querySelectorAll('.investor-amount');
    let total = 0;
    amounts.forEach(input => {
      total += parseFloat(input.value) || 0;
    });
    document.getElementById('investorTotal').textContent = total.toLocaleString('ja-JP');
  }

  function toggleInfoPopup(buttonId) {
    const popup = document.getElementById(buttonId);
    popup.classList.toggle('show');
  }

  document.addEventListener('click', function(event) {
    if (!event.target.classList.contains('info-btn')) {
      document.querySelectorAll('.info-popup').forEach(popup => {
        popup.classList.remove('show');
      });
    }
  });

  function copyToCurrentPeriod() {
    // 「直前期」の「純資産の部合計」の入力値を取得
    const currentPeriodInput = document.getElementById('currentPeriodNetAsset');
    const currentPeriodValue = currentPeriodInput ? currentPeriodInput.value : '';

    // 「正確な評価」の入力欄に複写
    const netAssetTaxValue = document.getElementById('netAssetTaxValue');
    if (netAssetTaxValue) {
      netAssetTaxValue.value = currentPeriodValue;
    }

  }
</script>

<div style="display: flex; align-items: center; gap: 16px; margin-bottom: 32px;">
  <svg width="80" height="80" viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg">
    <!-- Head -->
    <circle cx="40" cy="20" r="12" fill="none" stroke="#2563eb" stroke-width="2.5"/>
    
    <!-- Body -->
    <path d="M 40 32 L 25 50 L 32 50 L 32 65 L 48 65 L 48 50 L 55 50 L 40 32 Z" fill="none" stroke="#16a34a" stroke-width="2.5" stroke-linejoin="round"/>
    
    <!-- Stethoscope -->
    <path d="M 42 38 Q 45 38 46 42 Q 46 48 40 52 Q 34 48 34 42 Q 35 38 38 38" fill="none" stroke="#2563eb" stroke-width="2.5" stroke-linecap="round"/>
    <circle cx="40" cy="56" r="2.5" fill="#16a34a"/>
  </svg>
  
  <h1>簡単！！ 出資持分の評価額試算ツール</h1>
</div>

<p>
医療法人の出資持分の評価額の概算を知りたい方向けのツールです。
</p>

<div class="section">
  <h2>本ツールの目的</h2>
  <ul>
    <li>持分あり医療法人を経営しており、相続発生時の概算を知りたい</li>
    <li>正確でなくてもよいので、まずは目安を把握したい</li>
    <li>決算書・出資者名簿が手元にある</li>
  </ul>
</div>

<div class="section">
  <h2>ご用意いただくもの</h2>
  <ul>
    <li>直近3期分の決算書</li>
    <li>出資者名簿</li>
  </ul>

  <p class="note">
    ※ 正確な評価額を算出するには、税理士等の専門家へご相談ください。
  </p>
</div>

<div class="section">
  <h2>STEP１．医療法人の規模を判定するためのデータを選択する</h2>

  <table>
    <tr>
      <th class="left">項目</th>
      <th>入力</th>
    </tr>
    <tr>
      <td class="left">正職員数</td>
      <td>
        <select name="employees" id="employees">
          <option value="">-- 選択してください --</option>
          <option value="1">5人以下</option>
          <option value="2">5人超20人以下</option>
          <option value="3">20人超35人以下</option>
          <option value="4">35人超70人未満</option>
          <option value="5">70人以上</option>
        </select>
      </td>
    </tr>
    <tr>
      <td class="left">貸借対照表の「総資産」の金額</td>
      <td>
        <select name="total_assets" id="totalAssets">
          <option value="">-- 選択してください --</option>
          <option value="1">4,000万円未満</option>
          <option value="2">4,000万円以上2億5,000万円未満</option>
          <option value="3">2億5,000万円以上5億円未満</option>
          <option value="4">5億円以上15億円未満</option>
          <option value="5">15億円以上</option>
        </select>
      </td>
    </tr>
    <tr>
      <td class="left">損益計算書の「事業収益（又は医業収益、売上高）」の合計額<br>
      </td>
      <td>
        <select name="sales" id="sales">
          <option value="">-- 選択してください --</option>
          <option value="1">6,000万円未満</option>
          <option value="2">6,000万円以上2億5,000万円未満</option>
          <option value="3">2億5,000万円以上5億円未満</option>
          <option value="4">5億円以上20億円未満</option>
          <option value="5">20億円以上</option>
        </select>
      </td>
    </tr>
  </table>
</div>

<div class="section">
  <h2>STEP2．決算書より医療法人の財務データを入力【単位：円】</h2>

  <table>
    <thead>
      <tr>
        <th class="left">項目</th>
        <th>直前期</th>
        <th>直前々期</th>
        <th>直前々々期</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td class="left">
          「貸借対照表」の「純資産の部（又は資本の部）合計」の金額（注１）
          <button class="info-btn" onclick="toggleInfoPopup('infoPopup1')">正確な評価</button>
          <div id="infoPopup1" class="info-popup">
            もしくは<br>
            法人税申告書の別表五(一)上、「Ⅰ利益積立金額」及び<br>
            「Ⅱ資本金等の額」の各「差引翌期首現在」列
            「差引合計額」行の合計額
          </div>
        </td>
        <td><input type="number" id="currentPeriodNetAsset"></td>
        <td><input type="number"></td>
        <td><input type="number" disabled style="background-color: #f0f0f0; color: #999; cursor: not-allowed;"></td>
      </tr>
      <tr>
        <td class="left">
          貸借対照表の各勘定科目の金額について、相続税評価額とした金額を基に計算した<br>
          「純資産」の金額を上書き入力してください。
          <button class="copy-btn" onclick="copyToCurrentPeriod()">複写</button>
        </td>
        <td><input type="number" id="netAssetTaxValue"></td>
        <td><input type="number" disabled style="background-color: #f0f0f0; color: #999; cursor: not-allowed;"></td>
        <td><input type="number" disabled style="background-color: #f0f0f0; color: #999; cursor: not-allowed;"></td>
      </tr>
      <tr>
        <td class="left">
          「損益計算書」の「税引前当期純利益」の金額
          <button class="info-btn" onclick="toggleInfoPopup('infoPopup2')">正確な評価</button>
          <div id="infoPopup2" class="info-popup">
            もしくは<br>
            法人税申告書上の「所得金額」に下記の金額を加減算した金額を入力してください。<br>
            ・受取配当等の益金不算入の金額は加算<br>
            ・繰越欠損金のうち損金算入した金額は加算<br>
            ・非経常的な利益の金額は減算
          </div>
        </td>
        <td><input type="number"></td>
        <td><input type="number"></td>
        <td><input type="number"></td>
      </tr>
    </tbody>
  </table>

  <p class="note">
    （注１）<br>
    「貸借対照表」の「純資産の部（又は資本の部）合計」の金額に、<br>
    ・賞与引当金、退職給付引当金等の税務上損金にならない金額を加算<br>
    ・圧縮積立金、圧縮引当金等の金額を減算<br>
    した金額を使用するとより正確な試算が可能となります。
  </p>
</div>

<div class="section">
  <h2>STEP3．出資者名簿より出資者情報を入力【単位：円】</h2>

  <table>
    <thead>
      <tr>
        <th>№</th>
        <th class="left">出資者名</th>
        <th>出資金額</th>
      </tr>
    </thead>
    <tbody id="investorTableBody">
      <tr class="investor-row">
        <td class="row-number">1</td>
        <td class="left"><input type="text"></td>
        <td><input type="number" class="investor-amount" oninput="updateInvestorTotal()"></td>
      </tr>
      <tr class="investor-row">
        <td class="row-number">2</td>
        <td class="left"><input type="text"></td>
        <td><input type="number" class="investor-amount" oninput="updateInvestorTotal()"></td>
      </tr>
      <tr class="investor-row">
        <td class="row-number">3</td>
        <td class="left"><input type="text"></td>
        <td><input type="number" class="investor-amount" oninput="updateInvestorTotal()"></td>
      </tr>
    </tbody>
    <tfoot>
      <tr style="background-color: #f2f2f2; font-weight: bold;">
        <td>合計</td>
        <td class="left"></td>
        <td id="investorTotal">0</td>
      </tr>
    </tfoot>
  </table>

  <button type="button" class="add-row" onclick="addInvestorRow()">＋ 出資者を追加</button>

  <p class="note">
    ※ 出資金額の合計は、貸借対照表の出資金（資本金）と一致させてください。
  </p>
</div>

<div class="section">
  <button type="button" onclick="goToResults()" style="background-color: #2563eb; color: white; border: none; padding: 12px 24px; border-radius: 4px; cursor: pointer; font-size: 16px;">
    計算結果を確認する
  </button>
</div>

<script>
  function goToResults() {
    // 出資者情報を収集
    const investors = [];
    const rows = document.querySelectorAll('.investor-row');

    rows.forEach(row => {
      const name = row.querySelector('input[type="text"]').value;
      const amount = row.querySelector('.investor-amount').value;

      if (name || amount) {
        investors.push({
          name: name,
          amount: parseFloat(amount) || 0
        });
      }
    });

    // 相続税評価額による純資産を取得
    const netAssetTaxValue = document.getElementById('netAssetTaxValue').value;

    // STEP1のデータを取得
    const employees = document.getElementById('employees').value;
    const totalAssets = document.getElementById('totalAssets').value;
    const sales = document.getElementById('sales').value;

    // localStorageに保存
    localStorage.setItem('investorData', JSON.stringify(investors));
    localStorage.setItem('netAssetTaxValue', netAssetTaxValue);
    localStorage.setItem('employees', employees);
    localStorage.setItem('totalAssets', totalAssets);
    localStorage.setItem('sales', sales);

    // doctor_2.htmlに遷移
    window.location.href = 'doctor_2.html';
  }
</script>

</body>
</html>
